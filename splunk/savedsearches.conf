# Splunk saved searches and alerts for Linux IDS
# Place in $SPLUNK_HOME/etc/system/local/ or app directory

# Critical Security Alert - Immediate notification
[IDS Critical Security Alert]
search = index=security sourcetype=linux_ids severity=critical | stats count by host, event_type, description | where count > 0
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
action.email.to = security@example.com
action.email.subject = CRITICAL: IDS Alert on $result.host$
action.email.message.alert = Critical security event detected: $result.description$
action.pagerduty = 1
alert_condition = search count > 0

# SSH Brute Force Detection
[SSH Brute Force Attack]
search = index=security sourcetype=linux_secure "Failed password" | stats count by src_ip, dest | where count > 10
dispatch.earliest_time = -10m
dispatch.latest_time = now
cron_schedule = */10 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
action.email.to = security@example.com
action.email.subject = SSH Brute Force Detected from $result.src_ip$
alert_condition = search count > 10

# New Root User Detection
[New Root Level User Created]
search = index=security sourcetype=linux_ids event_type=authentication "uid\":0" | dedup username
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# File Integrity Violation
[Critical File Modification]
search = index=security sourcetype=linux_ids event_type=file_integrity (path="/bin/*" OR path="/sbin/*" OR path="/usr/bin/*" OR path="/usr/sbin/*")
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */15 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Cryptocurrency Miner Detection
[Cryptocurrency Miner Detected]
search = index=security sourcetype=linux_ids threat_category=cryptominer OR process_name="*xmrig*" OR process_name="*minerd*"
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Web Shell Detection
[Potential Web Shell Upload]
search = index=security sourcetype=linux_ids event_type=file_integrity "web shell" OR (file="*.php" AND (signature="eval" OR signature="system" OR signature="exec"))
dispatch.earliest_time = -30m
dispatch.latest_time = now
cron_schedule = */30 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Privilege Escalation
[Privilege Escalation Attempt]
search = index=security sourcetype=linux_ids event_type=privilege_escalation OR (sourcetype=linux_secure AND ("FAILED su" OR "sudo.*COMMAND.*bash"))
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Port Scanning Detection
[Port Scan Detected]
search = index=security sourcetype=linux_ids threat_category=port_scan OR (sourcetype=linux_firewall AND DPT | stats dc(DPT) as port_count by SRC | where port_count > 10)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
alert_condition = search count > 0

# Suspicious Outbound Connection
[Suspicious Outbound Connection]
search = index=security sourcetype=linux_ids threat_category=c2_communication OR remote_ip IN ("185.220.*", "195.123.*", "45.142.*")
dispatch.earliest_time = -10m
dispatch.latest_time = now
cron_schedule = */10 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Hidden Process Detection
[Hidden Process Detected]
search = index=security sourcetype=linux_ids "Hidden processes detected" OR (event_type=process AND "deleted binary")
dispatch.earliest_time = -10m
dispatch.latest_time = now
cron_schedule = */10 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Configuration Change Alert
[Critical Configuration Modified]
search = index=security sourcetype=linux_ids event_type=configuration file IN ("/etc/ssh/sshd_config", "/etc/sudoers", "/etc/passwd", "/etc/shadow")
dispatch.earliest_time = -10m
dispatch.latest_time = now
cron_schedule = */10 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
alert_condition = search count > 0

# Resource Exhaustion
[Resource Exhaustion Attack]
search = index=security sourcetype=linux_ids event_type=resource (memory_percent > 95 OR cpu_percent > 95 OR usage_percent > 95)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
alert_condition = search count > 0

# Kernel Anomaly Detection
[Kernel Security Event]
search = index=security (sourcetype=linux_kernel AND ("segfault" OR "kernel panic" OR "BUG:" OR "Oops")) OR (sourcetype=linux_ids AND event_type=privilege_escalation AND "kernel")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
alert_condition = search count > 0

# Multiple Authentication Failures
[Multiple Authentication Failures]
search = index=security sourcetype=linux_secure "authentication failure" | stats count by user, src_ip | where count > 5
dispatch.earliest_time = -10m
dispatch.latest_time = now
cron_schedule = */10 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
alert_condition = search count > 5

# Suspicious DNS Activity
[Suspicious DNS Query]
search = index=security sourcetype=linux_ids "DNS tunneling" OR (query_length > 63) OR domain IN ("*.tk", "*.ml", "*.ga", "*.cf")
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */15 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
alert_condition = search count > 0

# After Hours Login
[After Hours Login Detected]
search = index=security sourcetype=linux_ids event_type=authentication "outside business hours" OR (sourcetype=linux_secure AND date_hour NOT IN (6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21))
dispatch.earliest_time = -1h
dispatch.latest_time = now
cron_schedule = 0 * * * *
enableSched = 1
alert.track = 1
alert.severity = 3
action.email = 1
alert_condition = search count > 0